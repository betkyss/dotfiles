#################################
#     Основные настройки        #
#################################

backend = "glx";
use-damage = false;
vsync = true;
use-ewmh-active-win = true;
detect-transient = true;
detect-client-leader = true;

#################################
#           Анимации v12        #
#################################

animations = (
  { triggers = [ "open", "show" ]; preset = "appear";     duration = 0.22; },
  { triggers = [ "close", "hide" ]; preset = "disappear";  duration = 0.18; },
  { triggers = [ "size", "position" ];
    preset = "geometry-change";
    duration = 0.16;
    conditions = [ "!override_redirect && (window_type = 'normal' || window_type = 'dialog')" ];
  }
);

#################################
#     Блюр и прозрачность       #
#################################

blur = {
  method = "dual_kawase";
  strength = 9;
  background = true;
  background-frame = true;
  background-fixed = true;
};

corner-radius = 10;
detect-rounded-corners = true;

rules = (
  { match = "!focused && !group_focused && !(class_g = 'flameshot' || class_g = 'Flameshot') && !override_redirect && (window_type = 'normal' || window_type = 'dialog' || window_type = 'utility' || window_type = 'toolbar')"; dim = 0.45; },
  { match = "window_type = 'dock' || window_type = 'desktop'";
    blur-background = false;
    corner-radius = 0;
    dim = 0;
  },
  { match = "window_type = 'dialog' || window_type = 'utility' || window_type = 'toolbar' || window_type = 'splash'"; opacity = 0.85; },
  { match = "I3_FLOATING_WINDOW@ && !(window_type = 'dock' || window_type = 'desktop')"; opacity = 0.85; },
  { match = "_GTK_FRAME_EXTENTS@"; blur-background = false; },
  { match = "window_type = 'menu' || window_type = 'popup_menu' || window_type = 'dropdown_menu'";
    blur-background = false;
    opacity = 0.85;
    dim = 0;
    animations = (
      { triggers = [ "show" ]; preset = "appear";    duration = 0.08; },
      { triggers = [ "hide" ]; preset = "disappear"; duration = 0.08; }
    );
  },
  { match = "(class_g = 'firefox' || class_g = 'Firefox' || class_g = 'Navigator') && (window_type = 'menu' || window_type = 'popup_menu' || window_type = 'dropdown_menu')";
    opacity = 0.85;
    blur-background = false;
    dim = 0;
  },
  # Firefox drag-and-drop (override-redirect) surfaces: no blur/opacity/radius
  { match = "(class_g = 'firefox' || class_g = 'Firefox' || class_g = 'Navigator') && override_redirect";
    opacity = 1.0;
    blur-background = false;
    corner-radius = 0;
    dim = 0;
  },
  { match = "class_g = 'Polybar'";
    opacity = 0.85;
    blur-background = false;
    corner-radius = 0;
    dim = 0;
  },
  { match = "class_g = 'Alacritty'"; opacity = 0.85; },
  { match = "class_g = 'Flameshot' || class_g = 'flameshot'"; dim = 0; opacity = 0.85; },
  { match = "class_g = 'TelegramDesktop'"; opacity = 0.85; },
  { match = "(class_g = 'firefox' || class_g = 'Firefox' || class_g = 'Navigator') && window_type = 'normal'"; opacity = 0.85; },
  { match = "class_g = 'obsidian' || class_g = 'Obsidian'";
    opacity = 0.85;
    blur-background = true;
    dim = 0;
  },
  # Rofi: transparency and background blur
  { match = "class_g = 'Rofi' || class_g = 'rofi'";
    opacity = 0.85;
    blur-background = true;
    dim = 0;
  },
  { match = "class_g = 'AmneziaVPN' || class_g = 'amnezia-vpn' || class_g = 'amneziavpn'";
    opacity = 0.85;
    blur-background = true;
    dim = 0;
  },
  { match = "class_g = 'Spotify' || class_g = 'spotify'";
    opacity = 0.85;
    blur-background = true;
    dim = 0;
  },
  { match = "window_type = 'dnd'";
    opacity = 1.0;
    blur-background = false;
    corner-radius = 0;
    dim = 0;
  },
  { match = "override_redirect";
    opacity = 1.0;
    blur-background = false;
    corner-radius = 0;
    dim = 0;
  },
  # Dunst notifications: transparent with background blur
  { match = "class_g = 'Dunst' || class_g = 'dunst'";
    opacity = 0.85;
    blur-background = true;
    dim = 0;
    corner-radius = 0;
  },
  { match = "window_type = 'notification'"; corner-radius = 0; }
);
